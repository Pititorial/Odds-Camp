<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <div class="flex justify-between items-start mb-6">
        <div>
          <h1 class="text-3xl font-bold mb-2"><%= @post.title %></h1>
          <p class="text-gray-600">
            Posted by <%= @post.user.email %> <%= time_ago_in_words(@post.created_at) %> ago
          </p>
        </div>
        <% if current_user == @post.user %>
          <div class="flex space-x-2">
            <%= link_to 'Edit', edit_post_path(@post), class: 'text-blue-500 hover:text-blue-700 cursor-pointer' %>
            <%= button_to 'Delete', post_path(@post), method: :delete, class: 'text-red-500 hover:text-red-700 cursor-pointer', data: { confirm: 'Are you sure?' } %>
          </div>
        <% end %>
      </div>

      <div class="prose max-w-none mb-8">
        <%= @post.content %>
      </div>

      <div class="flex items-center space-x-4 border-t pt-4">
        <div>
          <% if current_user && @post.likes.exists?(user: current_user) %>
            <%= button_to post_like_path(@post, @post.likes.find_by(user: current_user)), 
                method: :delete, 
                class: 'like-button liked cursor-pointer' do %>
              <span class="material-symbols-rounded">favorite</span>
              <span class="count"><%= @post.likes.count %></span>
            <% end %>
          <% else %>
            <%= button_to post_likes_path(@post), 
                method: :post, 
                class: 'like-button cursor-pointer' do %>
              <span class="material-symbols-rounded">favorite</span>
              <span class="count"><%= @post.likes.count %></span>
            <% end %>
          <% end %>
        </div>

        <%= render 'posts/partials/share_buttons', post: @post %>
      </div>

      <%= render 'posts/partials/comments', post: @post, comment: @comment, comments: @comments %>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  window.addEventListener('click', function(e) {
    const dropdowns = document.querySelectorAll('[data-controller="dropdown"]');
    dropdowns.forEach(dropdown => {
      const menu = dropdown.querySelector('[data-dropdown-target="menu"]');
      if (!dropdown.contains(e.target)) {
        menu.classList.add('hidden');
      }
    });
  });

  document.addEventListener('DOMContentLoaded', function() {
    const dropdowns = document.querySelectorAll('[data-controller="dropdown"]');
    dropdowns.forEach(dropdown => {
      const button = dropdown.querySelector('[data-action="dropdown#toggle"]');
      const menu = dropdown.querySelector('[data-dropdown-target="menu"]');
      
      button.addEventListener('click', function(e) {
        e.stopPropagation();
        menu.classList.toggle('hidden');
      });
    });
  });
<% end %> 